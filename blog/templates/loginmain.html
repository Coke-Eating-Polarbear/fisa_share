{% load static %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Jua&family=Nanum+Gothic&display=swap');
    </style>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸ˆìœµ ë¦¬í¬íŠ¸</title>
    <link rel="stylesheet" href="{% static 'css/loginmain.css' %}">

    <style>
    </style>
</head>
<body>
    {% csrf_token %}
    <header>
        <div class="navbar">
            <!-- ë¡œê³  -->
            <div class="logo">
                <a href="{% url 'loginmain' %}">
                    <img src="{% static 'img/header_logo.png' %}" alt="ë¡œê³ ">
                </a>
            </div>
            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="nav-links">
                <a href="{% url 'originreport' %}">ë‚´ ê¸ˆìœµ ë°”ë¡œë³´ê¸°</a>
                <div class="dropdown">
                    <a href="#">ë‚´ ì˜ˆ/ì ê¸ˆ ì°¾ê¸°</a>
                    <div class="dropdown-content">
                        <a href="{% url 'top5' %}">ì‹ ê·œìƒí’ˆì¶”ì²œ</a>
                        <a href="{% url 'better' %}">ê¸°ì¡´ìƒí’ˆë¹„êµ</a>
                        <a href="{% url 'search' %}">ìƒí’ˆê²€ìƒ‰</a>
                    </div>
                </div>
                <a href="{% url 'spending_mbti' %}">ìŠ¬ê¸°ë¡œìš´ ì†Œë¹„ìƒí™œ</a>
            </div>
            <!-- íšŒì› ì •ë³´ ë° ë§ˆì´í˜ì´ì§€ -->
            <div class="user-info">
                <span>{{ user_name }}ë‹˜</span>
                <a href="./mypage">ë§ˆì´í˜ì´ì§€</a>
                <form method="POST" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button name="logout">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </div>
        </div>
    </header>
</body>
</html>

    <div class="carousel">
            <!-- ìŠ¬ë¼ì´ë“œ ì»¨í…Œì´ë„ˆ -->
            <div class="slides">
                <!-- ì²« ë²ˆì§¸ ìŠ¬ë¼ì´ë” -->
                <div class="slide active">
                    <div class="container">
                        <div class="summary" style="background: #DCF0FD; display: flex; align-items: center;">
                            <!-- ì™¼ìª½ ì„¹ì…˜ -->
                            <div style="flex: 1.5; padding: 20px;">
                                <h2>
                                    <span class="text">ê³ ê°ë‹˜ì˜ ê¸ˆìœµì ìˆ˜: <span id="analysis-score"></span> <span class="score-summary"></span></span> <br>
                                </h2>
        
                                <!-- ì ìˆ˜ ë° ìš”ì•½ 
                                <p class="finance-score">
                                    <strong class="lighter-heading">ê³ ê°ë‹˜ì˜ ê¸ˆìœµì ìˆ˜:</strong> 
                                    <span id="analysis-score"></span> 
                                    <span class="score-summary"></span>
                                </p>
                                -->
                                <p class="finance-summary">
                                    <strong class="lighter-heading">í˜„ì¬ ê¸ˆìœµ ìƒí™© ìš”ì•½:</strong> 
                                    <span id="summary"></span>
                                </p>
        
                                <!-- ìì„¸íˆ ë³´ê¸° ë²„íŠ¼ -->
                                <a href="{% url 'originreport' %}" class="details-button">ğŸ€ ê¸ˆìœµ ë¦¬í¬íŠ¸ ë³´ëŸ¬ê°€ê¸°</a>
                            </div>
        
                            <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ -->
                            <div style="flex: 1; text-align: center;">
                                <img src="{% static 'img/ë©”ì¸ë¡œê³ 1.png' %}" alt="ë©”ì¸ ë¡œê³ " style="max-width: 80%; max-height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
        
                <!-- ë‘ ë²ˆì§¸ ìŠ¬ë¼ì´ë” -->
                <div class="slide">
                    <div class="container">
                        <div class="summary" style="display: flex; align-items: center; background-color: #eff5ff;">
                            <!-- ì™¼ìª½ ì„¹ì…˜ -->
                            <div style="flex: 1.5; padding: 20px;">
                                <h2 style="margin-bottom: 20px; letter-spacing: 0.8px;">
                                    <span class="text">ë‚˜ì—ê²Œ ë”± ë§ëŠ” ê¸ˆìœµ ìƒí’ˆ ì°¾ê¸°</span>
                                </h2>
        
                                <!-- ì„¤ëª… -->
                                <p class="lighter-heading">
                                    ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì‹ ê·œ ì˜ˆ/ì ê¸ˆ ìƒí’ˆ ì¶”ì²œ<br>
                                    ê¸°ì¡´ë³´ë‹¤ ë” ì¢‹ì€ ìš°ëŒ€ ê¸ˆë¦¬ë¥¼ ê°–ëŠ” ì˜ˆ/ì ê¸ˆ ìƒí’ˆ ì¶”ì²œ
                                </p>

                                <!-- ë²„íŠ¼ -->
                                <div class="button-group" style="margin-top: 20px;">
                                    <a href="{% url 'top5' %}" class="details-button" style="border-radius: 41px; background-color: #eff5ff; color: #09a56f;">ğŸ˜º ì‹ ê·œ ìƒí’ˆ ì¶”ì²œ</a><br>
                                    <a href="{% url 'better' %}" class="details-button" style="border-radius: 41px; background-color: #eff5ff; color: #09a56f;">ğŸ¦¢ ê¸°ì¡´ ìƒí’ˆ ë¹„êµ</a>
                                </div>
                            </div>

                            <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ -->
                            <div style="flex: 1; text-align: center;">
                                <img src="{% static 'img/ë©”ì¸ë¡œê³ 2.png' %}" alt="ì˜ˆì ê¸ˆ ìƒí’ˆ ì´ë¯¸ì§€" style="max-width: 90%; max-height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
        
                <!-- ì„¸ ë²ˆì§¸ ìŠ¬ë¼ì´ë” -->
                <div class="slide">
                    <div class="container">
                        <div class="summary" style="display: flex; align-items: center; background-color: #EAE8FF;">
                            <!-- ì™¼ìª½ ì„¹ì…˜ -->
                            <div style="flex: 1.5; padding: 20px;">
                                <h2 style="margin-bottom: 20px;">
                                    <span class="text">ìŠ¬ê¸°ë¡œìš´ ì†Œë¹„ìƒí™œ ë„ìš°ë¯¸</span>
                                </h2>
                
                                <!-- ì„¤ëª… -->
                                <p class="lighter-heading">
                                    1. ë‚˜ì˜ ì†Œë¹„ íŒ¨í„´ í•œëˆˆì— í™•ì¸í•˜ê¸°<br>
                                    2. ë‚´ ì†Œë¹„ë¥¼ ì¤„ì—¬ì£¼ëŠ” í˜œíƒ ë†’ì€ ì¹´ë“œ ì¶”ì²œë°›ê¸°
                                </p>
                
                                <!-- ë²„íŠ¼ -->
                                <div class="button-group" style="margin-top: 20px;">
                                    <a href="{% url 'spending_mbti' %}" class="details-button" style="background-color: #6356DA; color: #eff5ff;">ğŸ” ìì„¸íˆ ë³´ëŸ¬ê°€ê¸°</a>
                                </div>
                            </div>
                
                            <!-- ì˜¤ë¥¸ìª½ ì„¹ì…˜ -->
                            <div style="flex: 1; text-align: center;">
                                <img src="{% static 'img/ë©”ì¸ë¡œê³ 3.png' %}" alt="ë©”ì¸ ë¡œê³ " style="max-width: 90%; max-height: 100%;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        
            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="carousel-navigation">
                <button class="nav-dot active" data-index="0"></button>
                <button class="nav-dot" data-index="1"></button>
                <button class="nav-dot" data-index="2"></button>
            </div>
        </div>
    </div>
    
        <!-- ë§ì¶¤ ì˜ˆì¸¡ ìƒí’ˆ TOP 5 ì„¹ì…˜ -->
        <div class="product-section">
                <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
            <p class="section-intro" style="font-size: 14px; color: #666; text-align: center; margin-bottom: 10px;">
                ë‚˜ì—ê²Œ ë§ëŠ” ì˜ˆ/ì ê¸ˆ ìƒí’ˆ, ì°¾ê¸° í˜ë“œì…¨ì£ ?<br>ë§ˆì´ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‰½ê³  ì •í™•í•˜ê²Œ ë¹„êµí•´ë“œë¦½ë‹ˆë‹¤.
            </p>
            
            <h2 style="margin-top:1rem; margin-bottom: 2.5rem; color:#121212; font-family: 'Jua', sans-serif; font-weight: 400; font-size: 38px;">{{ user_name }}ë‹˜ ë§ì¶¤ ì˜ˆ/ì ê¸ˆ ìƒí’ˆ TOP 5!</h2>
    
            <div class="product-list">
                {% for product in final_recommend %}
                    <div class="product-card">
                        <p class="product-name">âœ” {{ product.product_name }}</p>
                        <p class="bank-name">{{ product.bank_name }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.base_rate }}%</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.max_preferential_rate }}%</p>
                        <!-- <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.signup_method }}</p> -->
                    </div>
                {% endfor %}
            
                {% for product in deposit_recommend %}
                    <div class="product-card">
                        <p class="product-name">âœ” {{ product.name }}</p>
                        <p class="bank-name">{{ product.bank }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.baser }}%</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.maxir }}%</p>
                        <!-- <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.method }}</p> -->
                    </div>
                {% endfor %}
            </div>
    
            <a href="{% url 'top5' %}" class="learn-more-button" style="border-radius: 41px; background-color: #4a88e5; color: #eff5ff; font-weight:bold;">ğŸ’°ìì„¸íˆ ì•Œì•„ë³´ê¸°</a>
        </div>
    </div>
    
    <div class="news-intro" style="font-size: 14px; color: #000000; text-align: center; margin-bottom: -20px; margin-top: 100px; font-weight: 250;">
        <h2>ğŸ“° ì˜¤ëŠ˜ì˜ ê¸ˆìœµ ê´€ë ¨ ì£¼ìš” ë‰´ìŠ¤ì™€ ì›Œë“œí´ë¼ìš°ë“œë¥¼ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”!</h2>
    </div> 

    <div class="container_news">
        <div class="news-summary">
            {% if news_entries %}
                {% for news in news_entries %}
                <a href="{{ news.url }}" target="_blank" class="summary-box">
                    <div class="title">{{ news.title }}</div>
                    <div class="news-analyze">{{ news.summary }}</div>
                </a>
                {% endfor %}
            {% else %}
                <p>ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
        <div class="word-cloud">
            <h2>ğŸ’¬ ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ í‚¤ì›Œë“œ</h2>
            {% if image_base64 %}
                <img src="data:image/png;base64,{{ image_base64 }}" alt="Word Cloud Image">
            {% else %}
                <p>ì˜¤ëŠ˜ì˜ ì›Œë“œí´ë¼ìš°ë“œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>

    <script>
        const user_data = JSON.parse('{{ user_data|safe|escapejs }}');
        const average_data = JSON.parse('{{ average_data|safe|escapejs }}');
        const userValues = Object.values(user_data);
        const averageValues = Object.values(average_data);

        document.addEventListener("DOMContentLoaded", function () {

            const totalIncome = userValues[2]; // ì´ìˆ˜ì…
            const totalSpending = userValues[3]; // ì´ì§€ì¶œ
            const averageIncome = averageValues[2]; // í‰ê· ìˆ˜ì…

            console.log('totalIncome',totalIncome);
            console.log('totalSpending',totalSpending);
            console.log('averageIncome',averageIncome);

            // A ê³„ì‚° (ì§€ì¶œ/ìˆ˜ì… ë¹„ìœ¨)
            const spendingRatio = (totalSpending / totalIncome) * 100;
            let aStatus;
            if (spendingRatio <= 50) {
                aStatus = "ì¢‹ìŒ";
            } else if (spendingRatio <= 70) {
                aStatus = "ë³´í†µ";
            } else {
                aStatus = "ë‚˜ì¨";
            }

            // B ê³„ì‚° (í‰ê·  ìˆ˜ì…ê³¼ ë¹„êµ)
            const bStatus = totalIncome > averageIncome ? "ë†’ìŒ" : "ë‚®ìŒ";

            // ì ìˆ˜ì™€ ê¸ˆìœµ ë‚ ì”¨ ê²°ì •
            let score, condition, summary, emoji;
            if (aStatus === "ì¢‹ìŒ" && bStatus === "ë†’ìŒ") {
                score = 100;
                condition = "Excellent";
                summary = "ëª¨ë“  ì¡°ê±´ì´ ì´ìƒì ì´ë©°, ì¬ì • ìƒíƒœê°€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.<br>" + "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œ ë¹„ìœ¨ì´ ì¢‹ê³  í‰ê·  ì´ìƒìœ¼ë¡œ ì•ˆì •ì ì´ë©°<br>" +"ì¥ê¸°ì ì¸ ì¬ì • ê´€ë¦¬ê°€ ë§¤ìš° ì–‘í˜¸í•œ í¸ì…ë‹ˆë‹¤.";
                emoji = "ğŸ˜";
            } else if (aStatus === "ì¢‹ìŒ" && bStatus === "ë‚®ìŒ") {
                score = 90;
                condition = "VeryGood";
                summary = "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œ ë¹„ìœ¨ì´ ì¢‹ì§€ë§Œ í‰ê· ì— ë¹„í•´ ì‚´ì§ ë‚®ì€ í¸ì…ë‹ˆë‹¤.<br>" + "ì¬ì •ì ìœ¼ë¡œ ì•ˆì •ì ì´ì§€ë§Œ ì¡°ê¸ˆ ë” ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                emoji = "ğŸ¥°";
            } else if (aStatus === "ë³´í†µ" && bStatus === "ë†’ìŒ") {
                score = 80;
                condition = "Good";
                summary = "í‰ê· ë³´ë‹¤ ìˆ˜ì…ì´ ë†’ê³ , ì¬ì •ìƒíƒœê°€ ë¬´ë‚œí•˜ì§€ë§Œ ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì´ ë†’ì€ í¸ì…ë‹ˆë‹¤.<br>" +"ì§€ì¶œ ë¶€ë¶„ì„ ì•½ê°„ ê°œì„ í•œë‹¤ë©´ ë” ì¢‹ì€ ì¬ì •ìƒíƒœê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ";
                emoji = "ğŸ˜€";
            } else if (aStatus === "ë³´í†µ" && bStatus === "ë‚®ìŒ") {
                score = 70;
                condition = "Soso";
                summary = "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì˜ ë¹„ì¤‘ì´ ë†’ì€í¸ì€ ì•„ë‹ˆì§€ë§Œ<br>"+"í‰ê·  ìˆ˜ì…ì„ ê³ ë ¤í•œë‹¤ë©´ ì¡°ê¸ˆ ë” ê´€ë¦¬ì™€ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                emoji = "ğŸ˜Š";
            } else if (aStatus === "ë‚˜ì¨" && bStatus === "ë†’ìŒ") {
                score = 60;
                condition = "NotBad";
                summary = "í‰ê· ë³´ë‹¤ ì†Œë“ì´ ë†’ì€ í¸ì´ì§€ë§Œ ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì´ ë§ìŠµë‹ˆë‹¤.<br>" + "ì¥ê¸°ì ìœ¼ë¡œ ì•ˆì •ì ì¸ ì¬ì • ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ì„  ì¶”ê°€ì ì¸ ê´€ë¦¬ì™€ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                emoji = "ğŸ¥²";
            } else {
                score = 50;
                condition = "Bad";
                summary = "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì´ ë†’ì•„ ì¬ì • ìƒíƒœê°€ ì¢‹ì§€ì•Šì€ ìœ„í—˜í•œ ìƒíƒœì…ë‹ˆë‹¤.<br>" + "ì¦‰ê°ì ì¸ ì¬ì • ê´€ë¦¬ì™€ ê°œì„  ì¡°ì¹˜ê°€ í•„ìš”í•œ ìƒí™©ì…ë‹ˆë‹¤.";
                emoji = "ğŸ˜¢";
            }

            // ë°ì´í„° í™”ë©´ì— ì¶œë ¥
            document.getElementById('analysis-score').textContent = `${score}ì `;
            document.getElementById('summary').innerHTML = summary;
            document.querySelector('.score-summary').textContent = emoji;
            });
        
        document.addEventListener("DOMContentLoaded", function () {
            const slides = document.querySelectorAll(".slide");
            const slideContainer = document.querySelector(".slides");
            const dots = document.querySelectorAll(".nav-dot");
            let currentIndex = 0;
            let slideInterval;


            // ìŠ¬ë¼ì´ë“œ ë³€ê²½ í•¨ìˆ˜
            function changeSlide(index) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle("active", i === index); // í™œì„±í™”ëœ ìŠ¬ë¼ì´ë“œ í‘œì‹œ
                });
                dots.forEach((dot, i) => {
                    dot.classList.toggle("active", i === index); // í™œì„±í™”ëœ ë„¤ë¹„ê²Œì´ì…˜ í‘œì‹œ
                });
                currentIndex = index; // í˜„ì¬ ìŠ¬ë¼ì´ë“œ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
            }

            /// ìë™ ìŠ¬ë¼ì´ë“œ ì‹œì‘
            function startAutoSlide() {
                slideInterval = setInterval(() => {
                    currentIndex = (currentIndex + 1) % slides.length;
                    changeSlide(currentIndex);
                }, 6000);
            }

            // ìë™ ìŠ¬ë¼ì´ë“œ ì´ˆê¸°í™”
            function resetAutoSlide() {
                clearInterval(slideInterval);
                startAutoSlide();
            }

            // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            dots.forEach((dot) => {
                dot.addEventListener("click", () => {
                    const index = parseInt(dot.getAttribute("data-index"), 10);
                    changeSlide(index); // í´ë¦­í•œ ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
                    resetAutoSlide(); // ìœ ì§€ ì‹œê°„ ì´ˆê¸°í™”
                });
            });
            // ì´ˆê¸° ì„¤ì •
            setSlideHeight(); // ìŠ¬ë¼ì´ë“œ ë†’ì´ ì„¤ì •
            window.addEventListener("resize", setSlideHeight); // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ë†’ì´ ì¬ì„¤ì •
            changeSlide(currentIndex); // ì´ˆê¸° ìŠ¬ë¼ì´ë“œ ì„¤ì •
            startAutoSlide(); // ìë™ ìŠ¬ë¼ì´ë“œ ì‹œì‘
        });


        document.addEventListener("DOMContentLoaded", function () {
            const titles = document.querySelectorAll(".title"); // ëª¨ë“  .title ìš”ì†Œ ì„ íƒ

            titles.forEach(title => {
                if (title.innerText.length > 22) {
                    title.innerText = title.innerText.substring(0, 22) + "..."; // 17ìê¹Œì§€ë§Œ í‘œì‹œí•˜ê³  ìƒëµ ë¶€í˜¸ ì¶”ê°€
                }
            });
        });
    </script>

    <footer>
        <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 434 ìƒì•”ITíƒ€ì›Œ 6ì¸µ</p> 
        <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">ê³ ê°ì§€ì› : 02-3151-7000 | ì´ë©”ì¼: woorifis.lab44@gmail.com </p >
        <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">COPYRIGHTÂ©ìš°ë¦¬ì²œë§Œí•´ìš”</p >
    </footer >

    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
</body>
</html>