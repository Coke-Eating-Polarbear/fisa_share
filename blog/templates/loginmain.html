{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸ˆìœµ ë¦¬í¬íŠ¸</title>
    <link rel="stylesheet" href="{% static 'css/loginmain.css' %}">
    <style>
    </style>
</head>
<body>
    {% csrf_token %}
    <header>
    <div class="navbar">
        <div class="logo">
            <a href="{% url 'loginmain' %}">
                <img src="{% static 'img\header_logo.png' %}" style="vertical-align: middle; margin-left: 100px;" alt="ë¡œê³ ">
            </div>
            <div class="nav-links" style="flex-grow: 1; text-align: center; margin-right: 220px;">
                <a href="{% url 'originreport' %}" style=" font-weight: bold; color: #121212;">ê¸ˆìœµë¶„ì„ ë¦¬í¬íŠ¸</a> 
                <div class="dropdown">
                    <a href="#" style=" font-weight: bold; color: #121212;">ì˜ˆ/ì ê¸ˆ ì¶”ì²œ</a>
                    <div class="dropdown-content">
                        <a href="{% url 'top5' %}" style="font-size: 0.8rem;">ì‹ ê·œì ê¸ˆì¶”ì²œ</a>
                        <a href="{% url 'better' %}" style="font-size: 0.8rem;">ê¸°ì¡´ìƒí’ˆë¹„êµ</a>
                    </div>
                </div> 
                <a href="{% url 'spending_mbti' %}" style=" font-weight: bold; color: #121212;">ì†Œë¹„MBTI</a>
            </div>
           <!-- íšŒì› ì •ë³´ ë° ë§ˆì´í˜ì´ì§€ -->
        <div class="user-info">
            <span style="font-size: 1.1rem;">{{ user_name }}ë‹˜</span> 
            <a href="./mypage" style="margin-left: 15px; 
            text-decoration: none; 
            font-size: 1.1rem; 
            font-weight: bold; 
            color: #121212;">ë§ˆì´í˜ì´ì§€</a> 
            <form method="POST" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button name="logout" style="margin-left: 10px; 
                margin-right: 100px; 
                padding: 5px 10px; 
                font-size: 0.9rem; 
                font-weight: bold; 
                background-color: #291e4ee5; 
                color: white; 
                border: none; 
                border-radius: 5px; 
                cursor: pointer;">
                    ë¡œê·¸ì•„ì›ƒ
                </button>
            </form>
        </div>
    </div>
    </header>

    <!-- ì¤‘ì•™ ê¸ˆìœµ ë¦¬í¬íŠ¸ ë‚´ìš© -->
    <div class="container" style="margin-left: 10px; margin-right: 10px;">
        <div class="summary">
            <h2>ê¸ˆìœµë¦¬í¬íŠ¸ ìš”ì•½</h2>
            <!-- <p>ìì„¸íˆ ë³´ê¸°ë¥¼ ëˆ„ë¥´ë©´ ê¸ˆìœµë¦¬í¬íŠ¸ ì°½ìœ¼ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</p> -->
            <div style="display: grid; grid-template-columns: 2fr 2fr 6fr;">
                <div class="box" id="analysis-score" style="color: #5950d6;"></div>
                <div class="score-summary"><span class="score-summary"></span></div>
                <div class="box" id="summary" ></div>
            </div>
            <a href="{% url 'originreport' %}"class="details-button">ìì„¸íˆ ë³´ê¸°</a>
        </div>
    
        <!-- ë§ì¶¤ ì˜ˆì¸¡ ìƒí’ˆ TOP 5 ì„¹ì…˜ -->
        <div class="product-section">
            <h2 style="margin-bottom: 1rem;">{{ user_name }}ë‹˜ ë§ì¶¤ ì˜ˆ/ì ê¸ˆ ìƒí’ˆ TOP 5!</h2>
    
            <div class="product-list">
                {% for product in final_recommend %}
                    <div class="product-card">
                        <p><strong>ìƒí’ˆëª…:</strong> {{ product.product_name }}</p>
                        <p><strong>ì€í–‰:</strong> {{ product.bank_name }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.base_rate }}</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.max_preferential_rate }}</p>
                        <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.signup_method }}</p>
                    </div>
                {% endfor %}
            
                {% for product in deposit_recommend %}
                    <div class="product-card">
                        <p><strong>ìƒí’ˆëª…:</strong> {{ product.name }}</p>
                        <p><strong>ì€í–‰:</strong> {{ product.bank }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.baser }}</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.maxir }}</p>
                        <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.method }}</p>
                    </div>
                {% endfor %}
            </div>
    
            <a href="{% url 'top5' %}" class="learn-more-button">ìì„¸íˆ ì•Œì•„ë³´ê¸°</a>
        </div>
    </div>
    

    <div class="container_news">
        <div class="news-summary">
            {% if news_entries %}
                {% for news in news_entries %}
                <a href="{{ news.url }}" target="_blank" class="summary-box">
                    <div class="title">{{ news.title }}</div>
                    <div class="news-analyze">{{ news.summary }}</div>
                </a>
                {% endfor %}
            {% else %}
                <p>ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
        <div class="word-cloud">
            <h2 style="font-weight: bold;">ì˜¤ëŠ˜ì˜ ë‰´ìŠ¤ í‚¤ì›Œë“œ</h2>
            {% if image_base64 %}
                <img src="data:image/png;base64,{{ image_base64 }}" alt="Word Cloud Image">
            {% else %}
                <p>ì˜¤ëŠ˜ì˜ ì›Œë“œí´ë¼ìš°ë“œ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
    </div>

    <script>
        const user_data = JSON.parse('{{ user_data|safe|escapejs }}');
        const average_data = JSON.parse('{{ average_data|safe|escapejs }}');
        const userValues = Object.values(user_data);
        const averageValues = Object.values(average_data);

        document.addEventListener("DOMContentLoaded", function () {

            const totalIncome = userValues[2]; // ì´ìˆ˜ì…
            const totalSpending = userValues[3]; // ì´ì§€ì¶œ
            const averageIncome = averageValues[2]; // í‰ê· ìˆ˜ì…

            console.log('totalIncome',totalIncome);
            console.log('totalSpending',totalSpending);
            console.log('averageIncome',averageIncome);

            // A ê³„ì‚° (ì§€ì¶œ/ìˆ˜ì… ë¹„ìœ¨)
            const spendingRatio = (totalSpending / totalIncome) * 100;
            let aStatus;
            if (spendingRatio <= 50) {
                aStatus = "ì¢‹ìŒ";
            } else if (spendingRatio <= 70) {
                aStatus = "ë³´í†µ";
            } else {
                aStatus = "ë‚˜ì¨";
            }

            // B ê³„ì‚° (í‰ê·  ìˆ˜ì…ê³¼ ë¹„êµ)
            const bStatus = totalIncome > averageIncome ? "ë†’ìŒ" : "ë‚®ìŒ";

            // ì ìˆ˜ì™€ ê¸ˆìœµ ë‚ ì”¨ ê²°ì •
            let score, condition, summary, emoji;
            if (aStatus === "ì¢‹ìŒ" && bStatus === "ë†’ìŒ") {
                score = 100;
                condition = "Excellent";
                summary = "ëª¨ë“  ì¡°ê±´ì´ ì´ìƒì ì´ë©°, ì¬ì • ìƒíƒœê°€ ë§¤ìš° ì¢‹ìŠµë‹ˆë‹¤.\n" + "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œ ë¹„ìœ¨ì´ ì¢‹ê³  í‰ê·  ì´ìƒìœ¼ë¡œ ì•ˆì •ì ì´ë©°\n" +"ì¥ê¸°ì ì¸ ì¬ì • ê´€ë¦¬ê°€ ë§¤ìš° ì–‘í˜¸í•œ í¸ì…ë‹ˆë‹¤.";
                emoji = "ğŸ˜";
            } else if (aStatus === "ì¢‹ìŒ" && bStatus === "ë‚®ìŒ") {
                score = 90;
                condition = "VeryGood";
                summary = "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œ ë¹„ìœ¨ì´ ì¢‹ì§€ë§Œ í‰ê· ì— ë¹„í•´ ì‚´ì§ ë‚®ì€ í¸ì…ë‹ˆë‹¤.\n" + "ì¬ì •ì ìœ¼ë¡œ ì•ˆì •ì ì´ì§€ë§Œ ì¡°ê¸ˆ ë” ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                emoji = "ğŸ¥°";
            } else if (aStatus === "ë³´í†µ" && bStatus === "ë†’ìŒ") {
                score = 80;
                condition = "Good";
                summary = "í‰ê· ë³´ë‹¤ ìˆ˜ì…ì´ ë†’ê³ , ì¬ì •ìƒíƒœê°€ ë¬´ë‚œí•˜ì§€ë§Œ ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì´ ë†’ì€ í¸ì…ë‹ˆë‹¤.\n" +"ì§€ì¶œ ë¶€ë¶„ì„ ì•½ê°„ ê°œì„ í•œë‹¤ë©´ ë” ì¢‹ì€ ì¬ì •ìƒíƒœê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ";
                emoji = "ğŸ˜€";
            } else if (aStatus === "ë³´í†µ" && bStatus === "ë‚®ìŒ") {
                score = 70;
                condition = "Soso";
                summary = "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì˜ ë¹„ì¤‘ì´ ë†’ì€í¸ì€ ì•„ë‹ˆì§€ë§Œ\n"+"í‰ê·  ìˆ˜ì…ì„ ê³ ë ¤í•œë‹¤ë©´ ì¡°ê¸ˆ ë” ê´€ë¦¬ì™€ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                emoji = "ğŸ˜Š";
            } else if (aStatus === "ë‚˜ì¨" && bStatus === "ë†’ìŒ") {
                score = 60;
                condition = "NotBad";
                summary = "í‰ê· ë³´ë‹¤ ì†Œë“ì´ ë†’ì€ í¸ì´ì§€ë§Œ ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì´ ë§ìŠµë‹ˆë‹¤.\n" + "ì¥ê¸°ì ìœ¼ë¡œ ì•ˆì •ì ì¸ ì¬ì • ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ì„  ì¶”ê°€ì ì¸ ê´€ë¦¬ì™€ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.";
                emoji = "ğŸ¥²";
            } else {
                score = 50;
                condition = "Bad";
                summary = "ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œì´ ë†’ì•„ ì¬ì • ìƒíƒœê°€ ì¢‹ì§€ì•Šì€ ìœ„í—˜í•œ ìƒíƒœì…ë‹ˆë‹¤.\n" + "ì¦‰ê°ì ì¸ ì¬ì • ê´€ë¦¬ì™€ ê°œì„  ì¡°ì¹˜ê°€ í•„ìš”í•œ ìƒí™©ì…ë‹ˆë‹¤.";
                emoji = "ğŸ˜¢";
            }

            // ë°ì´í„° í™”ë©´ì— ì¶œë ¥
            document.getElementById('analysis-score').textContent = `${score}ì `;
            document.getElementById('summary').textContent = summary;
            document.querySelector('.score-summary').textContent = emoji;
            });
    </script>

    <footer>
        <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0;">ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 434 ìƒì•”ITíƒ€ì›Œ 6ì¸µ</p> 
        <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0;">ê³ ê°ì§€ì› : 02-3151-7000 | ì´ë©”ì¼: woorifis.lab44@gmail.com </p >
        <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0;">COPYRIGHTÂ©ì²œë§Œí•´ìš”</p >
    </footer >

    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
</body>
</html>