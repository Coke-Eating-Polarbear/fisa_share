{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ì¶”ì²œ</title>
    <link rel="stylesheet" href="{% static 'css/recommend_savings_top5.css' %}">
    <link rel="stylesheet" href="{% static 'css/header.css' %}">

    <script>

        document.addEventListener("DOMContentLoaded", function () {
            // íƒ­ ë™ì‘ ì„¤ì •
            const tabs = document.querySelectorAll(".tab");
            const tabContents = document.querySelectorAll(".tab-content");

            tabs.forEach((tab, index) => {
                tab.addEventListener("click", () => {
                    tabs.forEach(t => t.classList.remove("active"));
                    tabContents.forEach(tc => tc.classList.remove("active"));

                    tab.classList.add("active");
                    tabContents[index].classList.add("active");
                });
            });

            // ìì„¸íˆë³´ê¸° í† ê¸€ ì„¤ì •
            document.querySelectorAll(".card-button").forEach((button) => {
                button.addEventListener("click", function () {
                    const detailsBox = this.nextElementSibling;
                    detailsBox.style.display = detailsBox.style.display === "block" ? "none" : "block";
                });
            });

            // ë‹«ê¸° ë²„íŠ¼ ë™ì‘ ì„¤ì •
            document.querySelectorAll(".close-button").forEach((closeButton) => {
                closeButton.addEventListener("click", function () {
                    const detailsBox = this.parentElement;
                    detailsBox.style.display = "none";
                });
            });

            // ì„œë²„ í†µì‹  í•¨ìˆ˜
            function addToFavorites(productId) {
                console.log("Added to favorites:", productId);
            }

            function removeFromFavorites(productId) {
                console.log("Removed from favorites:", productId);
            }
        });


        // ì˜ˆì ê¸ˆ ìì„¸íˆ ë³´ê¸° ë¡œê·¸ ìˆ˜ì§‘ì„ ìœ„í•œ ìë°” ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì¶”ê°€
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".card-button").forEach(button => {
                button.addEventListener("click", function () {
                    const card = this.closest(".card");
                    const productData = {
                        product_name: card.querySelector(".card-title").innerText.trim(),
                        bank: card.querySelector(".card-content p:nth-of-type(1)").innerText.replace("ì€í–‰:", "").trim(),
                        baser: card.querySelector(".card-content p:nth-of-type(2)").innerText.replace("ê¸°ì¤€ ê¸ˆë¦¬:", "").trim(),
                        maxir: card.querySelector(".card-content p:nth-of-type(3)").innerText.replace("ìµœëŒ€ ê¸ˆë¦¬:", "").trim(),
                        method: card.querySelector(".card-content p:nth-of-type(4)").innerText.replace("ê°€ì… ë°©ë²•:", "").trim(),
                    };
                    console.log(JSON.stringify(productData,));

                    // AJAX ìš”ì²­ìœ¼ë¡œ í´ë¦­ ë¡œê·¸ ì €ì¥
                    fetch('/log_click/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken')  // CSRF í† í° ì¶”ê°€
                        },
                        body: JSON.stringify(productData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === "success") {
                            console.log("Click logged successfully:", productData);
                        } else {
                            console.error("Error logging click:", data.message);
                        }
                    })
                    .catch(error => console.error("Error:", error));
                });
            });

            // CSRF í† í° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });


    </script>
</head>
<body>
    {% csrf_token %}
    <header>
        <div class="navbar">
            <!-- ë¡œê³  -->
            <div class="logo">
                <a href="{% url 'loginmain' %}">
                    <img src="{% static 'img/header_logo.png' %}" alt="ë¡œê³ ">
                </a>
            </div>
            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="nav-links">
                <a href="{% url 'originreport' %}">ë‚´ ê¸ˆìœµ ë°”ë¡œë³´ê¸°</a>
                <div class="dropdown">
                    <a href="#">ë‚´ ì˜ˆ/ì ê¸ˆ ì°¾ê¸°</a>
                    <div class="dropdown-content">
                        <a href="{% url 'top5' %}">ì‹ ê·œìƒí’ˆì¶”ì²œ</a>
                        <a href="{% url 'better' %}">ê¸°ì¡´ìƒí’ˆë¹„êµ</a>
                    </div>
                </div>
                <a href="{% url 'spending_mbti' %}">ìŠ¬ê¸°ë¡œìš´ ì†Œë¹„ìƒí™œ</a>
            </div>
            <!-- íšŒì› ì •ë³´ ë° ë§ˆì´í˜ì´ì§€ -->
            <div class="user-info">
                <span>{{ user_name }}ë‹˜</span>
                <a href="./mypage">ë§ˆì´í˜ì´ì§€</a>
                <form method="POST" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button name="logout" style="margin-top: -8px;" >ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </div>
        </div>
    </header>
</body>
</html>
<div class="container">
            <div class="main-content">
                <h2 style = " text-align: center; "> ğŸ± {{ user_name }}ë‹˜ ë§ì¶¤ ì˜ˆ/ì ê¸ˆ ì¶”ì²œ ìƒí’ˆ TOP 3ì—ìš©~ ğŸ± 
        </div>
    <!-- íƒ­ ì˜ì—­ -->
    <div style = "margin: 15px auto !important ;" class="container">

        <div class="outer-box">
    <div>
        <div class="tabs">
            <div class="tab active" onclick="showTab('deposit')">ì˜ˆê¸ˆ ì¶”ì²œ</div>
            <div class="tab" onclick="showTab('savings')">ì ê¸ˆ ì¶”ì²œ</div>
        </div>

        {% load static %}
        <!-- ì˜ˆê¸ˆ ì¶”ì²œ ì½˜í…ì¸  -->
        <div id="deposit" class="tab-content active">
            <div class="recommendations">
                <!-- ì¶”ì²œ 3ê°œë§Œ í‘œì‹œ -->
                {% for product in deposit_recommend|slice:":3" %}   
                <div class="card" onclick="location.href='{% url 'd-detail' product.dsid %}'">
                    <img src="{% static 'img/ì˜ˆê¸ˆ.PNG' %}" alt="ì˜ˆê¸ˆ ë¡œê³ ">
                    <div class="card-content">
                        <span class="card-title">{{ product.name }}</span><br>
                        <p><strong>ì€í–‰:</strong> {{ product.bank }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.baser }}%</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.maxir }}%</p>
                        <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.method }}</p>
                    </div>
                    <!-- <a href="{% url 'd-detail' product.dsid %}" class="card-button">ìì„¸íˆë³´ê¸°</a> -->
                </div>
                {% endfor %}
               
                <a href="{% url 'info' %}" class="new-action-button" style="display: block; text-align: center; margin: 20px auto;">ì„¸ë¶€ ì¡°ê±´ ì„¤ì •í•˜ê¸°</a>
            </div>
            
        </div>

        {% load static %}
        <!-- ì ê¸ˆ ì¶”ì²œ ì½˜í…ì¸  -->
            <div id="savings" class="tab-content">
                <div class="recommendations">
                    {% for product in final_recommend|slice:":3" %}
                    <div class="card" onclick="location.href='{% url 's-detail' product.DSID %}'">
                        <img src="{% static 'img/ì ê¸ˆ.PNG' %}" alt="ì ê¸ˆ ë¡œê³ ">
                        <div class="card-content">
                            
                            <span class="card-title">{{ product.product_name }}</span><br>
                            <p><strong>ì€í–‰:</strong> {{ product.bank_name }}</p>
                            <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.base_rate }}%</p>
                            <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.max_preferential_rate }}%</p>
                            <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.signup_method }}</p>
                        </div>
                        <!-- <a href="{% url 's-detail' product.DSID %}" class="card-button">ìì„¸íˆë³´ê¸°</a> -->
                    </div>
                    
                    {% endfor %}
                </div>
                    <p class="description-text">"ì„¸ë¶€ì¡°ê±´ ì„¤ì •"ì„ í†µí•´ì„œ ë” ì •í™•í•œ ì¶”ì²œì„ ë°›ì„ ìˆ˜ ìˆë‹¤ ëƒ¥~ğŸ¾</p>
                    <a href="{% url 'info' %}" class="new-action-button" style="display: block; text-align: center; margin: 20px auto;" >ì„¸ë¶€ ì¡°ê±´ ì„¤ì •í•˜ê¸°</a>
            </div>
            
    </div>
    </div>
</div>

<!-- ì‹¤ì‹œê°„ ì˜ˆì ê¸ˆ ì¶”ì²œ ì„¹ì…˜ -->
{% load static %}
<div class="container">
    <h2 style = " text-align: center; ">âœ¨ ì‹¤ì‹œê°„ ì¸ê¸°ìˆëŠ” ì˜ˆì ê¸ˆ ì¶”ì²œì´ë‹¤ëƒ¥~ âœ¨</h2>
    <div class="real-time-recommendations">
        <div class="recommendation-boxes">

            <!-- ì™¼ìª½ ìƒì -->
            <div class="recommendations_2">
                {% with filtered_data|first as product %}
                <div class="card">
                    <img src="{% static 'img/ì˜ˆê¸ˆ.PNG' %}" alt="ì˜ˆê¸ˆ ë¡œê³ ">
                    <div class="card-content">
                        <span class="card-title">{{ product.product_name|default:"ìƒí’ˆëª… ì—†ìŒ" }}</span><br>
                        <p><strong>ì€í–‰:</strong> {{ product.bank|default:"ì€í–‰ ì •ë³´ ì—†ìŒ" }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.baser|default:"-" }}%</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.maxir|default:"-" }}%</p>
                        <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.method|default:"ê°€ì… ë°©ë²• ì •ë³´ ì—†ìŒ" }}</p>
                    </div>
                </div>
                {% endwith %}
            </div>

            <!-- ì˜¤ë¥¸ìª½ ìƒì -->
            <div class="recommendations_2">
                {% with filtered_data|slice:"1:2"|first as product %}
                <div class="card">
                    <img src="{% static 'img/ì ê¸ˆ.PNG' %}" alt="ì ê¸ˆ ë¡œê³ ">
                    <div class="card-content">
                        <span class="card-title">{{ product.product_name|default:"ìƒí’ˆëª… ì—†ìŒ" }}</span><br>
                        <p><strong>ì€í–‰:</strong> {{ product.bank|default:"ì€í–‰ ì •ë³´ ì—†ìŒ" }}</p>
                        <p><strong>ê¸°ì¤€ ê¸ˆë¦¬:</strong> {{ product.baser|default:"-" }}%</p>
                        <p><strong>ìµœëŒ€ ê¸ˆë¦¬:</strong> {{ product.maxir|default:"-" }}%</p>
                        <p><strong>ê°€ì… ë°©ë²•:</strong> {{ product.method|default:"ê°€ì… ë°©ë²• ì •ë³´ ì—†ìŒ" }}</p>
                    </div>
                </div>
                {% endwith %}
            </div>

        </div>
    </div>

</div>
</div>
<footer>
    <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 434 ìƒì•”ITíƒ€ì›Œ 6ì¸µ</p> 
    <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">ê³ ê°ì§€ì› : 02-3151-7000 | ì´ë©”ì¼: woorifis.lab44@gmail.com </p >
    <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">COPYRIGHTÂ©ìš°ë¦¬ì²œë§Œí•´ìš”</p >
</footer >



<script>
    document.addEventListener("DOMContentLoaded", function () {
        const titleElements = document.querySelectorAll(".card-title"); // ì—¬ëŸ¬ ìš”ì†Œ ì„ íƒ
        titleElements.forEach((titleElement) => {
            if (titleElement.innerText.length > 15) {
                titleElement.innerText = titleElement.innerText.substring(0, 15) + "...";
            }
        });
    });

</script>

</body>
</html>
