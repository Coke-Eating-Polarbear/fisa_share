{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸ˆìœµ ë¶„ì„ í˜ì´ì§€</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        background-color: #ffffff;
    }
    header, footer {
        /* background-color: #ffffff; */
        padding: 10px;
        text-align: center;
        width: 100%;
        z-index: 1;
        border-bottom: 1px solid #ddd;
    }
    header {
        background-color: #ffffff;
        top: 0;
        position: fixed;
    }
    footer {
        /* position: fixed;  */
        background-color: #39334f;
        bottom: 0; 
        left: 0; 
        width: 100%;
    }
    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 0 20px;
    }
    .navbar div a {
        margin: 0 10px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
    }
    .container {
        padding-top: 80px;
        padding-bottom: 50px; /* footer ë†’ì´ë§Œí¼ í•˜ë‹¨ ì—¬ë°± ì¶”ê°€ */
        max-width: 1000px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 2fr 3fr;
        gap: 20px;
    }
    .left-box, .right-box {
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .left-box h2, .right-box h2 {
        font-size: 16px;
        margin-bottom: 10px;
        font-weight: normal;
    }
    .info {
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 5px;
        font-size: 14px;
        line-height: 1.5;
    }
    .progress-bar {
        background-color: #ddd;
        border-radius: 13px;
        overflow: hidden;
        margin: 10px 0;
        text-align: center;
        color: white;
        line-height: 20px;
        height: 20px;
        width: 100%;
    }
    .progress-bar-inner {
        height: 100%;
        border-radius: 13px;
        background-color: #4caf50;
        text-align: center;
        color: white;
        line-height: 20px;
    }
    .goal-progress img {
        width: 100%;
    }
    .calendar {
        margin-top: 10px;
        font-size: 14px;
    }
    .calendar table {
        width: 100%;
        margin-top: 10px;
        border-collapse: collapse;
        font-size: 14px;
    }
    .calendar td {
        padding: 5px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    .footer-box {
        grid-column: 1 / span 2;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 15px;
        text-align: center;
        font-size: 14px;
    }
    #pieChart {
        width: 100%;
        height: 300px;
    }
    hr {
        border: 0;
        border-top: 1px solid #ddd;
        margin: 20px 0;
    }
    .edit-profile-button {
    display: inline-block;
    margin-top: 20px;
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
}

.edit-profile-button:hover {
    background-color: #0056b3;
}
</style>
</head>
<body>

<header>
    <div class="navbar">
        <div class="logo">
            <a href="./">
                <img src="{% static 'img/fisa_logo_after.png' %}" style="vertical-align: middle;" alt="ìš°ë¦¬ FISA ë¡œê³ ">
                <span style="font-size: 1.5rem; font-weight: bold; margin-left: 10px;">ì˜ˆ/ì ê¸ˆ ì¶”ì²œ ì„œë¹„ìŠ¤</span>
        </div>
        <div>
            <a href="#report">ê¸ˆìœµë¶„ì„ ë¦¬í¬íŠ¸</a> |
            <a href="#comparison">ì˜ˆ/ì ê¸ˆ ë¹„êµ</a> |
            <a href="#spending">ì†Œë¹„MBTI</a>
        </div>
        <a>{{ user_name }}ë‹˜ |</a>
        <a href="#mypage">ë§ˆì´í˜ì´ì§€</a>
    </div>
</header>

<div class="container">
    <!-- Left Box -->
    <div class="left-box">
        <h2>{{ user_name }}ë‹˜</h2>
        <div class="info">
            <p>ì´ë²ˆë‹¬ ëª©í‘œ ì†Œë¹„ì•¡ : <span id="goalAmount">500,000</span>ì›</p>
            <p>ì‹¤ì œ ì´ë²ˆë‹¬ ì§€ì¶œ ì´ì•¡ : <span id="spentAmount">200,000</span>ì›</p>
            <div class="progress-bar">
                <div class="progress-bar-inner" id="savingsProgressBar">50%</div>
            </div>
            <p id="result">ëª©í‘œ ì†Œë¹„ì•¡ë³´ë‹¤ 200,000ì› ëœ ì“°ì…¨ì–´ìš”<br>
            ì˜í•˜ê³  ìˆì–´ìš”~ ì§€ê¸ˆì²˜ëŸ¼ë§Œ âœ¨<br></p>
        </div>
    </div>

    <!-- Right Box -->
    <div class="right-box">

        <!-- ì¹´ë“œ ì‚¬ìš© ë¹„ìœ¨ íŒŒì´ì°¨íŠ¸ -->
        <h2>ì¹´ë“œ ê²°ì œ ë‚´ì—­ ë¶„ì„</h2>
        <p>ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ì‚¬ìš© ë¹„ìœ¨</p>
        <div class="pie-chart">
            <canvas id="pieChart"></canvas>
        </div>

    </div>
</div>

<div class="container">
    <!-- Left Box -->
    <div class="left-box">
        <h2>{{ user_name }}ë‹˜</h2>
        <div class="info">
            <p>ì´ë²ˆë‹¬ ëª©í‘œ ì†Œë¹„ì•¡ : <span id="goalAmount">500,000</span>ì›</p>
            <p>ì‹¤ì œ ì´ë²ˆë‹¬ ì§€ì¶œ ì´ì•¡ : <span id="spentAmount">200,000</span>ì›</p>
            <div class="progress-bar">
                <div class="progress-bar-inner" id="savingsProgressBar">50%</div>
            </div>
            <p id="result">ëª©í‘œ ì†Œë¹„ì•¡ë³´ë‹¤ 200,000ì› ëœ ì“°ì…¨ì–´ìš”<br>
            ì˜í•˜ê³  ìˆì–´ìš”~ ì§€ê¸ˆì²˜ëŸ¼ë§Œ âœ¨<br></p>
        </div>
        <!-- í”„ë¡œí•„ ìˆ˜ì • ë²„íŠ¼ -->
        <a href="{% url 'update_profile'%}" class="edit-profile-button">í”„ë¡œí•„ ìˆ˜ì •</a>
    </div>
    <!-- Right Box -->
    <div class="right-box">
        <!-- <h2>ì €ì¶• ëª©í‘œ í˜„í™©</h2>-->
        <div class="goal">
            <div class="goal-progress">
                <div class="progress-bar">
                    <div class="progress-bar-inner" id="savingsProgressBar">20%</div>
                </div>
                <div>
                    <p>ì €ì¶• ìƒí’ˆëª…: <span id="productName">ì ê¸ˆ ìƒí’ˆëª…</span></p>
                    <p>í˜„ì¬ ê¸ˆì•¡: <span id="currentAmount">1,000,000</span>ì›</p>
                    <p>ëª©í‘œ ê¸ˆì•¡: <span id="targetAmount">10,000,000</span>ì›</p>
                    <p>í˜„ì¬ ì ìš©ê¸ˆë¦¬: <span id="currentInterestRate">2.5</span>%</p>
                    <p>ëª©í‘œ ê¸°ê°„: <span id="goalPeriod">2024-10-20 ~ 2025-10-20</span></p>
                    <p>ë§Œê¸° ì‹œ ì˜ˆìƒ ê¸ˆì•¡: <span id="expectedAmount">10,250,000</span>ì›</p>
                </div>
            </div>
            <p id="savingsResult">ì €ì¶• ëª©í‘œ 10% ë‹¬ì„±! ì¶•í•˜ë“œë¦½ë‹ˆë‹¤ ğŸ‰</p>
        </div>
    </div>
</div>

<div class="container">
    ëª©í‘œ ë‹¬ì„± 90% ì •ë„ (ì˜ˆ/ì ê¸ˆ ë§Œê¸°) ë‹¤ê°€ì˜¤ë©´ ë§Œê¸° ì‹œ ê³ ë ¤ ì‚¬í•­ ì œê³µ
</div>

<script>
    // ì†Œë¹„ ì§„í–‰ë¥  ë°” ì„¤ì •
    const goalAmount = parseFloat(document.getElementById('goalAmount').innerText.replace(/,/g, ''));
    const spentAmount = parseFloat(document.getElementById('spentAmount').innerText.replace(/,/g, ''));
    const progressBarInner = document.getElementById('savingsProgressBar');
    const result = document.getElementById('result');

    const progress = (spentAmount / goalAmount) * 100;
    progressBarInner.style.width = progress + '%';
    progressBarInner.innerText = Math.floor(progress) + '%';

    if (progress < 100) {
        result.innerHTML = `ëª©í‘œ ì†Œë¹„ì•¡ë³´ë‹¤ ${goalAmount - spentAmount}ì› ëœ ì“°ì…¨ì–´ìš”<br>ì˜í•˜ê³  ìˆì–´ìš”~ ì§€ê¸ˆì²˜ëŸ¼ë§Œ âœ¨<br>`;
    } else {
        result.innerHTML = `ì´ë²ˆë‹¬ ëª©í‘œ ì˜ˆì‚°ì„ ì´ˆê³¼í–ˆì–´ìš” ğŸ˜¡`;
    }

    // íŒŒì´ì°¨íŠ¸ ë°ì´í„° ì„¤ì • ë° ìƒì„±
    const ctx = document.getElementById('pieChart').getContext('2d');
    // ì˜ˆì‹œ ë°ì´í„° (DBì—ì„œ ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¥¼ ëŒ€ì²´)
    const cardData = {
        categories: ['ì‹ë¹„', 'ì‡¼í•‘', 'êµí†µ', 'ìœ í¥', 'ê¸°íƒ€'],
        amounts: [200000, 150000, 80000, 5000, 70000] // ê°ê°ì˜ ì¹´í…Œê³ ë¦¬ë³„ ì‚¬ìš© ê¸ˆì•¡
    };
    const totalAmount = cardData.amounts.reduce((acc, curr) => acc + curr, 0);

    // ì €ì¶• ì§„í–‰ë¥  ë°” ì„¤ì • ë° ë§Œê¸° ì‹œ ì˜ˆìƒ ê¸ˆì•¡ ê³„ì‚°
    const productName = "ì ê¸ˆ ìƒí’ˆëª…"; // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ê°’
    const currentAmount = parseFloat(document.getElementById('currentAmount').innerText.replace(/,/g, ''));
    const targetAmount = parseFloat(document.getElementById('targetAmount').innerText.replace(/,/g, ''));
    const currentInterestRate = parseFloat(document.getElementById('currentInterestRate').innerText.replace(/,/g, ''));
    const goalPeriodMonths = 12; // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ê°’
    const goalPeriod = new Date('2024-10-20'); // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ì‹œì‘ ë‚ ì§œ
    goalPeriod.setMonth(goalPeriod.getMonth() + goalPeriodMonths);
    document.getElementById('goalPeriod').innerText = `2024-10-20 ~ ${goalPeriod.getFullYear()}-${(goalPeriod.getMonth() + 1).toString().padStart(2, '0')}-${goalPeriod.getDate().toString().padStart(2, '0')}`;

    const savingsProgressBar = document.getElementById('savingsProgressBar');
    const savingsResult = document.getElementById('savingsResult');

    const savingsProgress = (currentAmount / targetAmount) * 100;
    savingsProgressBar.style.width = savingsProgress + '%' ;
    savingsProgressBar.innerText = Math.floor(progress) + '%';

    const pieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: cardData.categories,
            datasets: [{
                label: 'ì¹´í…Œê³ ë¦¬ë³„ ì¹´ë“œ ì‚¬ìš© ë¹„ìœ¨',
                data: cardData.amounts,
                backgroundColor: ['#ff6384', '#36a2eb', '#ffce56', '#4caf50', '#ff9f40'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right' // ë²”ë¡€ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const amount = context.raw;
                            const percentage = ((amount / totalAmount) * 100).toFixed(2);
                            return `${context.label}: ${amount.toLocaleString()}ì› (${percentage}%)`;
                        }
                    }
                },
        }
    },// Data Labels í”ŒëŸ¬ê·¸ì¸ í™œì„±í™”
    });

    //íŒŒì´ì°¨íŠ¸ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
    document.getElementById('pieChart').onclick = function(evt) {
        const points = pieChart.getElementsAtEventForMode(evt, 'nearest', { intersect: true }, true);
        if (points.length) {
            const index = points[0].index;
            const amount = cardData.amounts[index];
            const percentage = ((amount / totalAmount) * 100).toFixed(2);
            alert(`${cardData.categories[index]}: ${amount.toLocaleString()}ì› (${percentage}%)`);
        }}
</script>

<footer>
    <p>ê³ ê°ì§€ì›: 1234-5678 | ì´ë©”ì¼: support@finance.com</p>
    <p>Â©2024 YourCompany. All rights reserved.</p>
</footer>

</body>
</html>