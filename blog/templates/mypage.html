{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸ˆìœµ ë¶„ì„ í˜ì´ì§€</title>
<link rel="stylesheet" href="{% static 'css/mypage.css' %}">
<link rel="stylesheet" href="{% static 'css/header.css' %}">

<style>
</style>
</head>
<body>

</head>
<body>
    {% csrf_token %}
    <header>
        <div class="navbar">
            <!-- ë¡œê³  -->
            <div class="logo">
                <a href="{% url 'loginmain' %}">
                    <img src="{% static 'img/header_logo.png' %}" alt="ë¡œê³ ">
                </a>
            </div>
            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="nav-links">
                <a href="{% url 'originreport' %}">ë‚´ ê¸ˆìœµ ë°”ë¡œë³´ê¸°</a>
                <div class="dropdown">
                    <a href="#">ë‚´ ì˜ˆ/ì ê¸ˆ ì°¾ê¸°</a>
                    <div class="dropdown-content">
                        <a href="{% url 'top5' %}">ì‹ ê·œìƒí’ˆì¶”ì²œ</a>
                        <a href="{% url 'better' %}">ê¸°ì¡´ìƒí’ˆë¹„êµ</a>
                        <a href="{% url 'search' %}">ìƒí’ˆê²€ìƒ‰</a>
                    </div>
                </div>
                <a href="{% url 'spending_mbti' %}">ìŠ¬ê¸°ë¡œìš´ ì†Œë¹„ìƒí™œ</a>
            </div>
            <!-- íšŒì› ì •ë³´ ë° ë§ˆì´í˜ì´ì§€ -->
            <div class="user-info">
                <span>{{ user_name }}ë‹˜</span>
                <a href="./mypage">ë§ˆì´í˜ì´ì§€</a>
                <form method="POST" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button name="logout" style="margin-top: 0;">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </div>
        </div>
    </header>
</body>
</html>

        <div class="row-container">
            <!-- ëª©í‘œ ì†Œë¹„ ìƒì -->
            <div class="box-container">
                <!-- ìƒë‹¨: ì‚¬ìš©ì ì´ë¦„ê³¼ í”„ë¡œí•„ ìˆ˜ì • ë²„íŠ¼ -->
                <div class="header-row">
                    <h2 class="user-name">{{ user_name }}ë‹˜</h2>
                </div>
        
                <!-- ì¤‘ì•™: ëª©í‘œ ì†Œë¹„ ì •ë³´ -->
                <div style="background-color: #f2f2f783;border-radius: 10px;">
                <!-- ëª©í‘œ ì†Œë¹„ ì •ë³´ -->
                {% if goal_amount %}
                    <p>ì´ë²ˆë‹¬ ëª©í‘œ ì†Œë¹„ì•¡: <strong>{{ goal_amount }} ì›</strong></p>
                    <p>ì´ë²ˆë‹¬ ì§€ì¶œ ì´ì•¡: <strong>{{ total_spent }} ì›</strong></p>
                    <!-- ì§„í–‰ë°” -->
                    <div id="progress-bar" style="height: 20px; background-color: #e0e0e0; border-radius: 10px; margin-top: 10px;">
                        <div id="progress-bar-inner" style="height: 100%; background-color: #0073E6; text-align: center; color: white; border-radius: 10px;"></div>
                    </div>
                    <p id="result"></p>

                    <!-- <p class="result">{{ comparison }}</p> -->
                {% else %}
                    <form method="POST">
                        {% csrf_token %}
                        <label for="goal_amount">ëª©í‘œ ì†Œë¹„ì•¡ì„ ì„¤ì •í•˜ì„¸ìš”:</label>
                        <input type="number" name="goal_amount" required>
                        <button type="submit">ì €ì¥</button>
                    </form>
                {% endif %}
                </div>
                <a href="{% url 'update_profile' %}" class="edit-profile-button">í”„ë¡œí•„ ìˆ˜ì •</a>
            </div>
        
            <!-- ì¹´ë“œ ê²°ì œ ë‚´ì—­ ë¶„ì„ -->
            <div class="right-box">
                <h2 class="user-name">ì´ë²ˆ ë‹¬ {{ user_name }}ë‹˜ì˜ ì§€ì¶œ í˜„í™©</h2>
                <!-- <p>ì´ë²ˆ ë‹¬ ì¹´ë“œ ì‚¬ìš© ë‚´ì—­</p> -->
                <div class="pie-chart">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>       


<div class="tab-box-container">

        <!-- íƒ­ê³¼ ìƒí’ˆ ì •ë³´ ì˜ì—­ -->
        <div class="tab-container">
            <button class="tab-button active" onclick="showTab('all')">ì „ì²´</button>
            <button class="tab-button" onclick="showTab('deposit')">ì˜ˆê¸ˆ</button>
            <button class="tab-button" onclick="showTab('savings')">ì ê¸ˆ</button>
        </div>

    <!-- ì „ì²´ ìƒí’ˆ ì •ë³´ -->
    <div id="all" class="tab-content active">
        <div class="product-list">
            {% for product in accounts_list %}
            <div class="product-container hidden-product">
                <div class="product-image" style="flex-shrink: 0;">
                    <img src="{% static 'img/ì²œëƒ¥ë§Œë•2.png' %}" alt="{{ product.pname }} ì´ë¯¸ì§€" style="width: 120px; height: 100px; border-radius: 8px; margin-right: 15px;">
                </div>
                <div class="product-details">
                    <h3>{{ product.pname }}</h3>
                    <p>ì”ê³ : {{ product.balance }}ì›</p>
                    <p>ì ìš© ê¸ˆë¦¬: {{ product.ds_rate }}%</p>
                    <!-- <p>ë§Œê¸°ì¼: {{ product.end_date }}</p> -->
                    <p>
                        ë§Œê¸°ì¼: 
                        {% if product.end_date == "2999-12-31" %}
                            ì—†ìŒ
                        {% else %}
                            {{ product.end_date }}
                        {% endif %}
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
        <p class="show-more-text" onclick="showMoreProducts('all')">ë”ë³´ê¸°</p>
    </div>

    <!-- ì˜ˆê¸ˆ ìƒí’ˆ ì •ë³´ -->
    <div id="deposit" class="tab-content">
        <div class="product-list">
            {% for deposit in d_list %}
            <div class="product-container hidden-product">
                <div class="product-image" style="flex-shrink: 0;">
                    <img src="{% static 'img/ì²œëƒ¥2.png' %}" alt="{{ product.pname }} ì´ë¯¸ì§€" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; margin-right: 15px;">
                </div>
                <div class="product-details" style="">
                    <h3>{{ deposit.pname }}</h3>
                    <p>ì´ ì˜ˆê¸ˆì•¡: {{ deposit.balance }}ì›</p>
                    <p>ì ìš© ê¸ˆë¦¬: {{ deposit.ds_rate }}%</p>
                    <p>
                        ë§Œê¸°ì¼: 
                        {% if deposit.end_date == "2999-12-31" %}
                            ì—†ìŒ
                        {% else %}
                            {{ deposit.end_date }}
                        {% endif %}
                    </p>
                </div>
                <div class="additional-box", style="letter-spacing: 0.1em;">
                    <strong>
                    {% if deposit.end_date == "2999-12-31" %}
                    ë§Œê¸°ì¼ì´ ì—†ëŠ” ììœ ì €ì¶•ì˜ˆíƒê¸ˆ ìƒí’ˆì…ë‹ˆë•! ğŸ¦†<br>    
                    í˜„ì¬ ì˜ˆê¸ˆ ì”ì•¡ì€ {{ deposit.balance }}ì› ì…ë‹ˆë•~<br>   
                    {% else %}
                        {% if deposit.days_remaining %}
                            ì˜ˆê¸ˆ ë§Œê¸°ê¹Œì§€ {{ deposit.days_remaining }}ì¼ ë‚¨ì•˜ìŠµë‹ˆë• !ğŸ¦†<br>
                            ì•„ìì•„ì ~ ì¡°ê¸ˆë§Œ ë” í˜ë‚´ë´ìš”!<br> ë§Œê¸°ê¹Œì§€ ë§Œë•ì´ê°€ ì‘ì›í• ê²Œìš” !!ë•~ ğŸ¦†ğŸ¤—<br>
                        {% else %}
                            í˜„ì¬ ì ê¸ˆì•¡ì€ {{ deposit.balance }}ì›ì…ë‹ˆë•~
                        {% endif %}
                    {% endif %}
                    </strong>
                </div>
            </div>
            {% endfor %}
        </div>
        <p class="show-more-text" onclick="showMoreProducts('deposit')">ë”ë³´ê¸°</p>
    </div>
    
    <!-- ì ê¸ˆ ìƒí’ˆ ì •ë³´ -->
    <div id="savings" class="tab-content">
        <div class="product-list">
            {% for savings in s_list %}
            <div class="product-container hidden-product">
                <div class="product-image" style="flex-shrink: 0;">
                    <img src="{% static 'img/ë§Œë•2.png' %}" alt="{{ product.pname }} ì´ë¯¸ì§€" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px; margin-right: 15px;">
                </div>
                <div class="product-details">
                    <h3>{{ savings.pname }}</h3>
                    <p>ì´ ì ê¸ˆì•¡: {{ savings.balance }}ì›</p>
                    <p>ì ìš© ê¸ˆë¦¬: {{ savings.ds_rate }}%</p>
                    <!-- <p>ë§Œê¸°ì¼: {{ savings.end_date }}</p> -->
                     <!-- ë§Œê¸°ì¼ ì¡°ê±´ì— ë”°ë¥¸ ì²˜ë¦¬ -->
                    <p>
                        ë§Œê¸°ì¼: 
                        {% if savings.end_date == "2999-12-31" %}
                            ì—†ìŒ
                        {% else %}
                            {{ savings.end_date }}
                        {% endif %}
                    </p>
                </div>
                <div class="additional-box" ,style="letter-spacing: 0.1em;">
                    <strong>
                    {% if savings.end_date == "2999-12-31" %}
                    í˜„ì¬ ì ê¸ˆì•¡ì€ {{ savings.balance }}ì›ì…ë‹ˆë•~<br>    
                    ëª©í‘œë¥¼ í–¥í•´ ì—´ì‹¬íˆ ì €ì¶• ì¤‘! ë©‹ì§€ë‹¤ë• !!ğŸ’š  <br> ê¾¸ì¤€íˆ í•˜ì‹œë©´ í° ì„±ê³¼ë¥¼ ì–»ì„ ê±°ì˜ˆìš”. ë•! ğŸ¦† 
                    {% else %}
                        {% if savings.days_remaining %}
                            ì ê¸ˆ ë§Œê¸°ê¹Œì§€ {{ savings.days_remaining }}ì¼ ë‚¨ì•˜ìŠµë‹ˆë• !ğŸ¦†<br>
                            ì•„ìì•„ì ~ ì¡°ê¸ˆë§Œ ë” í˜ë‚´ë´ìš”!<br> ë§Œê¸°ê¹Œì§€ ë§Œë•ì´ê°€ ì‘ì›í• ê²Œìš” !!ë•~ ğŸ¦†ğŸ¤—<br>
                        {% else %}
                            í˜„ì¬ ì ê¸ˆì•¡ì€ {{ savings.balance }}ì›ì…ë‹ˆë•~
                        {% endif %}
                    {% endif %}
                    </strong>
                </div>
            </div>
            {% endfor %}
        </div>
        <p class="show-more-text" onclick="showMoreProducts('savings')">ë”ë³´ê¸°</p>
    </div>
</div>


<div id="expiring-notification" class="expiring-container" style="display: none;">
    {% if expiring_accounts %}
        {% for account in expiring_accounts %}
            <p><strong><span class="expiring-product-name">{{ account.pname }}</span>ì´ ë§Œê¸°ê¹Œì§€ <span class="expiring-days">{{ account.days_remaining }}</span>ì¼ ë‚¨ì•˜ì–´ìš”!</strong></p>
        {% endfor %}
        <p><a href="{% url 'better' %}" style="color: #0073E6; text-decoration: none;">ìƒí’ˆ ë‘˜ëŸ¬ë³´ëŸ¬ê°€ê¸°</a></p>
    {% endif %}
</div>

<!-- ë§Œê¸° ìƒí’ˆì´ ì—†ì„ ë•Œ ì•Œë¦¼ -->
<div id="no-expiry-notification" class="expiring-container" style="display: none;">
    {% if not expiring_accounts %}
        <p>í˜„ì¬ ë§Œê¸°ê°€ ê°€ê¹Œìš´ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. 
        <a href="{% url 'top5' %}" style="color: #0073E6; text-decoration: none;">ìƒí’ˆ ë‘˜ëŸ¬ë³´ëŸ¬ê°€ê¸°</a></p>
    {% endif %}
</div>

<script>
    /*document.addEventListener('DOMContentLoaded', () => {
    // ì†Œë¹„ ì§„í–‰ë¥  ê³„ì‚°
    const goalAmount = parseFloat(document.getElementById('goalAmount').innerText.replace(/,/g, ''));
    const spentAmount = parseFloat(document.getElementById('spentAmount').innerText.replace(/,/g, ''));
    const progressBarInner = document.getElementById('savingsProgressBar');
    const result = document.getElementById('result');

    const progress = (spentAmount / goalAmount) * 100;
    progressBarInner.style.width = progress + '%';
    progressBarInner.innerText = Math.floor(progress) + '%';

    if (progress < 100) {
        result.innerHTML = `ëª©í‘œ ì†Œë¹„ì•¡ë³´ë‹¤ ${(goalAmount - spentAmount).toLocaleString()}ì› ëœ ì“°ì…¨ì–´ìš”<br>ì˜í•˜ê³  ìˆì–´ìš”~ ì§€ê¸ˆì²˜ëŸ¼ë§Œ âœ¨<br>`;
    } else {
        result.innerHTML = `ì´ë²ˆë‹¬ ëª©í‘œ ì˜ˆì‚°ì„ ì´ˆê³¼í–ˆì–´ìš” ğŸ˜¡`;
    }})*/

    document.addEventListener('DOMContentLoaded', function () {
        // Django í…œí”Œë¦¿ì—ì„œ ì „ë‹¬ëœ ë°ì´í„°
        const goalAmount = parseFloat("{{ goal_amount }}");
        const totalSpent = parseFloat("{{ total_spent }}");
        
        // ì§„í–‰ë¥  ê³„ì‚°
        const progress = (totalSpent / goalAmount) * 100;
        
        // ì§„í–‰ë°” ìŠ¤íƒ€ì¼ ë° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const progressBarInner = document.getElementById('progress-bar-inner');
        const resultText = document.getElementById('result');
        
        // ì§„í–‰ë°”ì™€ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        if (progress < 100) {
            progressBarInner.style.width = progress + '%';
            progressBarInner.innerText = Math.floor(progress) + '%';
            resultText.innerHTML = `<strong>ëª©í‘œ ì†Œë¹„ì•¡ë³´ë‹¤ ${(goalAmount - totalSpent).toLocaleString()}ì›<strong> ëœ ì“°ì…¨ì–´ìš”-!<br>` + 'ì˜í•˜ê³  ìˆì–´ìš”~ ì§€ê¸ˆì²˜ëŸ¼ë§ŒğŸ¤—';
        } else {
            progressBarInner.style.width = '100%';
            progressBarInner.innerText = '100%';
            resultText.innerText = `<strong>ëª©í‘œ ì†Œë¹„ì•¡ë³´ë‹¤ ${(totalSpent - goalAmount).toLocaleString()}ì›</strong> ë” ë§ì´ ì¼ì–´ìš”-!<br>` + 'ì¡°ê¸ˆ ë” ì•„ê»´ì•¼í•´ìš”~ğŸ˜¡';
        }
    });

    // íŒŒì´ ì°¨íŠ¸ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
    const pieChartElement = document.getElementById('pieChart'); // canvas ìš”ì†Œ ì°¸ì¡°

    if (pieChartElement) {
        const ctx = pieChartElement.getContext('2d');

        // Djangoì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ JavaScriptë¡œ ë³€í™˜
        const categoryData = JSON.parse('{{ category_percentages|safe }}');
        console.log("ì¹´í…Œê³ ë¦¬ ë°ì´í„°:", categoryData);

        const labels = Object.keys(categoryData);  // ì¹´í…Œê³ ë¦¬ ì´ë¦„
        const data = Object.values(categoryData); // ë°±ë¶„ìœ¨ ë°ì´í„°

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [
                    {
                        data: data,
                        backgroundColor: [
                            '#FF6F61', '#FFAA00', '#56C596', '#1EAC91', '#4A90E2',
                            '#0073E6', '#7D3EB5', '#E83E8C', '#F368E0', '#2F4F4F', '#FFD700'

                        ]
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right'
                    },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const percentage = context.raw.toFixed(2);
                                return `${context.label}: ${percentage}%`;
                            }
                        }
                    }
                }
            }
        });
    }
});

    // íƒ­ ì „í™˜ ê¸°ëŠ¥
    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));

        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }
        // ìµœëŒ€ 5ê°œ ìƒí’ˆë§Œ í‘œì‹œí•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ìˆ¨ê¹€
    document.addEventListener('DOMContentLoaded', () => {
        const allTabs = document.querySelectorAll('.tab-content');
        allTabs.forEach(tab => {
            const products = tab.querySelectorAll('.product-container');
            products.forEach((product, index) => {
                if (index < 3) {
                    product.classList.remove('hidden-product');
                }
            });

            // ìˆ¨ê²¨ì§„ ìƒí’ˆì´ ì—†ìœ¼ë©´ "ë”ë³´ê¸°" ìˆ¨ê¸°ê¸°
            const hiddenProducts = tab.querySelectorAll('.hidden-product');
            if (hiddenProducts.length === 0) {
                const moreText = tab.querySelector('.show-more-text');
                moreText.style.display = 'none';
            }
        });
    });

        // ë”ë³´ê¸° í´ë¦­ ì‹œ ì¶”ê°€ ìƒí’ˆ í‘œì‹œ
        function showMoreProducts(tabId) {
            const tab = document.getElementById(tabId);
            const hiddenProducts = tab.querySelectorAll('.hidden-product');
            hiddenProducts.forEach((product, index) => {
                if (index < 3) {
                    product.classList.remove('hidden-product');
                }
            });

            // ë” ì´ìƒ ìˆ¨ê²¨ì§„ ìƒí’ˆì´ ì—†ìœ¼ë©´ "ë”ë³´ê¸°" ìˆ¨ê¹€
            if (hiddenProducts.length <= 3) {
                const moreText = tab.querySelector('.show-more-text');
                moreText.style.display = 'none';
            }
        }
        // ì„œë²„ì—ì„œ ì˜ˆì ê¸ˆ ë§Œê¸° ë³€ìˆ˜ í•„ìš”
        document.addEventListener('DOMContentLoaded', () => {
            const expiringProducts = JSON.parse('{{ expiring_accounts_json|safe }}');
            const expiringContainer = document.getElementById('expiring-notification');
            const noExpiryContainer = document.getElementById('no-expiry-notification');
            
            if (expiringProducts.length > 0) {
                // ë§Œê¸° ìƒí’ˆì´ ìˆëŠ” ê²½ìš°
                expiringContainer.style.display = 'block';
                noExpiryContainer.style.display = 'none';
            } else {
                // ë§Œê¸° ìƒí’ˆì´ ì—†ëŠ” ê²½ìš°
                noExpiryContainer.style.display = 'block';
                expiringContainer.style.display = 'none';
            }
        });


</script>



<!-- footerëŠ” ì»¨í…Œì´ë„ˆ ë°–ìœ¼ë¡œ ì´ë™ -->
<footer>
    <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 434 ìƒì•”ITíƒ€ì›Œ 6ì¸µ</p> 
    <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">ê³ ê°ì§€ì› : 02-3151-7000 | ì´ë©”ì¼: woorifis.lab44@gmail.com </p >
    <p style="margin: 5px; line-height: 1.2; text-decoration: none; color: #afafb0; font-size: 0.8rem;">COPYRIGHTÂ©ìš°ë¦¬ì²œë§Œí•´ìš”</p >
</footer >


</body>
</html>
